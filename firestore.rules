rules_version = '2';

service cloud.firestore {
  match /databases/{database}/documents {
    match /{document=**} {
      allow read, write: if false;
    }

    match /teachers/{teacherId} {
      allow read, write: if request.auth != null && resource.data.teacher_email == request.auth.token.email;

      match /classes/{classId} {
        allow read, write: if request.auth != null && resource.data.teacher_email == request.auth.token.email;

        match /students/{studentId} {
          allow read, write: if request.auth != null && resource.data.teacher_email == request.auth.token.email;
        }
      }

      match /lessons/{lessonId} {
        allow read, write: if request.auth != null && resource.data.teacher_email == request.auth.token.email;
      }

      match /lesson_plans/{lessonId} {
        allow read, write: if request.auth != null && resource.data.teacher_email == request.auth.token.email;
      }
    }
  }
}

// - teacher (tenant)
//     - classes
//         - students
//     - lesson_plans
//         - questions
//     - lessons
//         - responses
//         - analysis
